#
# $Id: Makefile.in,v 1.4 1999/12/28 05:04:55 kunishi Exp $
#

PKGNAME=	solpkg-0.1

LOCALBASE=	/usr/local
PKGBUILDDIR=	@solpkg_topdir@

CWD:sh=		pwd
MAKEFILEDIR=	${CWD}/mk
PKGDIR=		${CWD}/pkg
RELEASEDIR=	${CWD}/release
WRKDIR=		${CWD}/work

COMPRESS=	/usr/bin/compress
CP=		/usr/bin/cp
PKGMK=		/usr/bin/pkgmk
PKGTRANS=	/usr/bin/pkgtrans
MKDIR=		/usr/bin/mkdir -p
RM=		/usr/bin/rm
SED=		/usr/bin/sed
TAR=		/usr/bin/tar

ARCH:sh=	/usr/bin/mach
OSREL:sh=	/usr/bin/uname -r

RELEASE_PKG_DIR=	/export/pub/Solaris/${ARCH}/${OSREL}
RELEASE_DATE:sh=	/usr/bin/date +%G%m%d

CORE_PACKAGES=	bmake-2.1.14.gz \
		gcc-2.8.1.gz \
		gmake-3.77.gz \
		gtar-1.12.gz \
		gzip-1.2.4 \
		libstdc++-2.8.1.1.gz \
		md5-1.0.gz \
		patch-2.5.gz \
		texinfo-3.12.gz \
		wget-1.5.3.gz

all:
	cd mk && ${MAKE} PKGBUILDDIR=${PKGBUILDDIR} LOCALBASE=${LOCALBASE}
	cd pkg && ${SED} -e 's!%%INSTPREFIX%%!${CWD}!g' prototype.in > prototype

release:	all
	${MKDIR} ${WRKDIR}
	${MKDIR} ${RELEASEDIR}
	${PKGMK} -o -f ${PKGDIR}/prototype -b ${CWD} -d ${WRKDIR}
	${PKGTRANS} ${WRKDIR} ${RELEASEDIR}/${PKGNAME} all
	${COMPRESS} ${RELEASEDIR}/${PKGNAME}
	cd ${RELEASE_PKG_DIR} && ${CP} ${CORE_PACKAGES} ${RELEASEDIR}
	${TAR} cf ${RELEASEDIR}/ports-${RELEASE_DATE}.tar ports
	${COMPRESS} ${RELEASEDIR}/ports-${RELEASE_DATE}.tar

install:
	cd mk && \
	  ${MAKE} PKGBUILDDIR=${PKGBUILDDIR} LOCALBASE=${LOCALBASE} install

clean:
	${RM} -f config.cache config.log config.status
	cd mk && ${MAKE} clean
	${RM} -f ${MAKEFILEDIR}/port.mk ${MAKEFILEDIR}/solpkg.conf
	${RM} -f ${PKGDIR}/pkginfo ${PKGDIR}/prototype
	${RM} -rf ${WRKDIR}
	${RM} -f ${RELEASEDIR}/${PKGNAME}

distclean:	clean
	${RM} -f Makefile
	${RM} -rf ${RELEASEDIR}
